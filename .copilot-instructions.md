# GitHub Copilot Instructions for Battle Simulator

## Project Overview
This is a **Battle Simulator** - a real-time strategy game built with React where two armies clash on a battlefield. Players can customize soldier stats, place armies by clicking/dragging on the battlefield, and watch battles unfold with dynamic animations and AI behavior.

## Technology Stack
- **Frontend**: React 18.3.1 with functional components and hooks
- **Styling**: Tailwind CSS 3.4.13 with custom CSS animations
- **Animations**: React Spring 9.7.4 for smooth soldier movements
- **Build Tool**: Create React App (react-scripts 5.0.1)
- **Deployment**: GitHub Pages (battlesim.online)
- **License**: GPL v3

## Project Structure
```
src/
├── App.js              # Main application component with battle logic
├── App.css             # Legacy CSS (mostly unused, prefer Tailwind)
├── index.js            # React entry point
├── index.css           # Global styles with Tailwind imports and custom animations
└── components/
    ├── Soldier.js      # Individual soldier component with animations
    ├── Soldier.css     # Legacy soldier styles (consider migrating to Tailwind)
    └── Projectile.js   # Projectile component (currently unused but available)
```

## Core Components & Architecture

### App.js (Main Game Logic)
- **State Management**: Uses useState hooks for:
  - `army1Stats`/`army2Stats`: Health, damage, speed, morale, aliveCount, kills
  - `soldiers`: Array of all soldier objects on battlefield
  - `battleStarted`: Boolean for simulation state
  - `winner`: Winning team identifier
  - UI states: `currentArmy`, `isDrawing`, `showHint`

- **Game Loop**: Uses useEffect with requestAnimationFrame for 60fps simulation
- **Soldier Placement**: Click/drag interaction to place soldiers
- **Battle Mechanics**: Real-time combat with collision detection, pathfinding, morale system

### Soldier.js Component
- **Props**: Receives soldier object with position, stats, team, state
- **Animations**: Uses react-spring for smooth movement transitions
- **Visual States**: Different animations for attacking, retreating, celebrating, dead
- **UI Elements**: Health bars, morale bars, team colors (blue vs red)

## Coding Patterns & Conventions

### State Management
```javascript
// Always use functional components with hooks
const [state, setState] = useState(initialValue);

// Update nested state objects immutably
setArmy1Stats(prev => ({
  ...prev,
  property: newValue
}));
```

### Soldier Object Structure
```javascript
const soldier = {
  id: `${team}-${timestamp}`,      // Unique identifier
  x: number,                       // Position coordinates
  y: number,
  health: number,                  // Current health
  maxHealth: number,               // Maximum health
  damage: number,                  // Attack damage
  speed: number,                   // Movement speed
  morale: number,                  // Current morale
  maxMorale: number,               // Maximum morale
  team: 'army1'|'army2',          // Team identifier
  alive: boolean,                  // Is soldier alive
  state: 'idle'|'moving'|'attacking'|'retreating'|'celebrating'|'dead',
  radius: 10,                      // Collision radius
  target: soldierObject|null,      // Current target
  lastAttack: timestamp|null       // Attack cooldown
};
```

### Battle Mechanics
- **Combat**: Turn-based with 1-second cooldown between attacks
- **Morale System**: Soldiers retreat when morale reaches 0
- **Collision Avoidance**: Soldiers avoid overlapping during movement
- **Victory Conditions**: Last team standing wins
- **Animations**: State-based animations (swing, shake, jump, fade-out)

### Responsive Design
- **Mobile-First**: Touch events for mobile soldier placement
- **Responsive Layout**: Uses CSS Grid and Flexbox with Tailwind
- **Prevent Scrolling**: Custom classes to prevent mobile scroll during gameplay

## Styling Guidelines

### Tailwind CSS Usage
- **Color Scheme**: Dark theme (gray-900 backgrounds)
- **Army Colors**: Blue for Army 1, Red for Army 2
- **Responsive**: Use `sm:`, `md:`, `lg:` prefixes
- **Components**: Prefer utility classes over custom CSS

### Custom Animations (in index.css)
```css
.animate-swing      /* Attack animation */
.animate-shake      /* Retreat animation */
.animate-jump       /* Celebration animation */
.animate-fade-out   /* Death animation */
```

### Utility Classes
```css
.prevent-select     /* Disable text selection */
.noscroll          /* Disable scrolling during gameplay */
.battlefield       /* Battlefield container */
```

## Performance Considerations
- **Animation Frame**: Use requestAnimationFrame for smooth 60fps updates
- **Collision Detection**: Optimized distance calculations
- **Memory Management**: Clean up timers and event listeners
- **State Updates**: Batch state updates to prevent unnecessary re-renders

## Development Guidelines

### Adding New Features
1. **Soldier Behaviors**: Add new states to the soldier state machine
2. **UI Components**: Create in `/components` directory with Tailwind styling
3. **Game Mechanics**: Extend the battle simulation loop in App.js
4. **Animations**: Add custom keyframes in index.css, use react-spring for complex movements

### Code Style
- **ES6+**: Use arrow functions, destructuring, template literals
- **Functional Programming**: Prefer map/filter/reduce over loops
- **Type Safety**: Use PropTypes or consider TypeScript migration
- **Comments**: Document complex game logic and battle mechanics

### Testing
- **Jest**: Unit tests available (currently basic)
- **User Testing**: Manual testing on mobile devices for touch interactions
- **Performance**: Monitor frame rate during large battles

## Common Patterns to Follow

### Event Handling
```javascript
// Handle both mouse and touch events
const handleMouseDown = (e) => { /* logic */ };
const handleTouchStart = (e) => {
  e.preventDefault(); // Prevent mobile scrolling
  /* same logic as mouse */
};
```

### Animation Integration
```javascript
// React Spring animations
const animationProps = useSpring({
  left: soldier.x,
  top: soldier.y,
  opacity: soldier.alive ? 1 : 0,
  config: { mass: 1, tension: 280, friction: 60 }
});
```

### State-Based Rendering
```javascript
// Conditional styling based on soldier state
const stateClass = soldier.state === 'attacking' ? 'animate-swing' :
                  soldier.state === 'retreating' ? 'animate-shake' : '';
```

## Features to Maintain/Extend
- **Real-time Battle Simulation**: 60fps game loop with collision detection
- **Interactive Army Placement**: Click/drag to place soldiers
- **Responsive Design**: Works on desktop and mobile
- **Visual Feedback**: Animations, health bars, battle messages
- **Customizable Stats**: Adjustable health, damage, speed, morale per army

## Known Technical Debt
- Some legacy CSS in App.css and Soldier.css (consider migrating to Tailwind)
- Projectile.js component exists but isn't integrated
- Could benefit from TypeScript for better type safety
- Message system is currently commented out but available

When suggesting code changes or new features, always consider the real-time nature of the game, mobile compatibility, performance implications, and maintain the existing dark theme aesthetic with blue vs red army distinction.
